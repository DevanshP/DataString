/*
 * DataString JavaScript and PHP Library v0.8.6
 * (c) 2010 Ken Snyder, MIT-style license
 * http://http://github.com/kensnyder/DataString
 *
 * The DataString class encapsulates a string to allow human-readable input and facilitate
 *   optimal human-readable formatting and machine-readable output
 */
(function(a){function j(n,l){for(var m in l){if(Object.prototype.hasOwnProperty.call(l,m)){n[m]=l[m]}}if(Object.prototype.valueOf!==l.valueOf){n.valueOf=l.valueOf}if(Object.prototype.toString!==l.toString){n.toString=l.toString}}function f(l){return typeof l=="string"?document.getElementById(l):l}var g={32:"  ",39:"'\"",42:"**",43:"==",44:",<",45:"--",46:".>",47:"//",59:";:",61:"=+",91:"[{",92:"\\|",93:"]}",106:"**",107:"=+",109:"-_",110:"..",111:"//",126:"`~",186:";:",187:"=+",188:",<",189:"-_",190:".>",191:"/?",192:"`~",219:"[{",220:"\\|",221:"]}",222:"'\""};function h(m){var n=m.keyCode,l;if(n<32){return}else{if(n>=48&&n<=57){l=String.fromCharCode(n);if(m.shiftKey){l=")!@#$%^&*(".charAt(l)}}else{if(n>=65&&n<=90){l=String.fromCharCode(n);if(!m.shiftKey){l=l.toLowerCase()}}else{if(n>=96&&n<=105){l="0123456789".charAt(n-96)}else{if((l=g[n])){l=l.charAt(m.shiftKey?1:0)}}}}}return l}var c=document.addEventListener?function(l,m,n){l.addEventListener(m,n,false)}:function(l,m,n){l.attachEvent("on"+m,n)};var i={validateInput:function(l,o){l=f(l);var m=new this;function n(){m.raw=l.value;if(!m.isValid()){o.call(m,l)}}c(l,"blur",n);c(l,"change",n);return l},autoFormatInput:function(m,n){m=f(m);var o=new this;function l(){o.raw=m.value;m.value=o.format.apply(o,n)}c(m,"blur",l);c(m,"change",l);return m},keyMaskInput:function(m){m=f(m);var n=new this;function l(o){o=o||window.event;if(o.ctrlKey||o.metaKey||o.altKey||!o.keyCode){return}var p=h(o);if(p&&!n.isAllowedChar(p)){o.preventDefault&&o.preventDefault();o.returnValue=false}}c(m,"keydown",l);return m}};var k={version:"0.8.6",setValue:function(l){this.raw=(typeof l=="undefined"||l===null?"":l+"").replace(/^\s+/,"").replace(/\s+$/,"");return this},equals:function(l){return this.valueOf()===(l instanceof d?l:new this.constructor(l)).valueOf()},copy:function(){return new this(this.raw)},isValid:function(){return true},isEmpty:function(){return this.raw===""},format:function(){return this.raw},toString:function(){return this.format()},valueOf:function(){return this.raw},isAllowedChar:function(l){return true}};var b=function(m){var l=function(n){if(n!==e){this.setValue(n)}};j(l,i);l.createSubclass=b;l.prototype=new this(e);l.prototype.constructor=l;l.prototype.constructor.parent=this;if(m){j(l.prototype,m)}return l};var e={};function d(l){if(l!==e){this.setValue(l)}}d.createSubclass=b;j(d,i);j(d.prototype,k);d.numberFormat=function(s,o){s=parseFloat(s+"");s=isNaN(s)?0:s;if(o>=0){s=s.toFixed(o)}else{s=""+s}var r=s.split(".");var q=r[0];var m=r[1];var l=(q.charAt(0)=="-"?"-":"");q=q.replace("-","");var p=[];while(q.length){p.unshift(q.slice(-3));q=q.slice(0,-3)}return l+p.join(d.numberFormat.thousandsSeparator)+(m?d.numberFormat.decimalPoint+m:"")};d.numberFormat.thousandsSeparator=",";d.numberFormat.decimalPoint=".";a.DataString=d})(this);DataString.Aba=DataString.createSubclass({isValid:function(){var a=this.format();if(a.length!=9||a=="000000000"){return false}var b=((a[0]*3)+(a[1]*7)+(a[2]*1)+(a[3]*3)+(a[4]*7)+(a[5]*1)+(a[6]*3)+(a[7]*7)+(a[8]*1));return((b%10)==0)},format:function(){return this.raw.replace(/\D/g,"")},isAllowedChar:function(a){return/\d/.test(a)}});DataString.Cc=DataString.createSubclass({matcher15:/^(\d{4})\D?(\d{6})\D?(\d{5})$/,matcher16:/^(\d{4})\D?(\d{4})\D?(\d{4})\D?(\d{4})$/,isValid:function(){return this.isValidFormat()&&this.isValidChecksum()&&this.isSupportedType()},isSupportedType:function(){var b=this.getType();var a=this.getSupportedTypes().join(" ");return(" "+a+" ").indexOf(" "+b+" ")>-1},isValidFormat:function(){return this.matcher16.test(this.raw)||this.matcher15.test(this.raw)},isValidChecksum:function(){var c=this.valueOf();var a=0,b=0;while(a<c.length){b+=((a%2)==0?2:1)*parseInt(c.substr(a++,1),10)}return(b%10)==0},format:function(b){var a;if((a=this.raw.match(this.matcher16))){if(b){a[1]="XXXX";a[2]="XXXXXX";a[3]="X".m.slice(1)}a.shift();return a.join("-")}else{if((a=this.raw.match(this.matcher15))){if(b){a[1]=a[2]=a[3]="XXXX"}a.shift();return a.join("-")}}return this.raw},valueOf:function(){return this.raw.replace(/\D/g,"")},getType:function(){var a;if((a=this.raw.match(/^(3[4-7]|4|5|6011)/))){switch(a[1]){case"6011":return"disc";case"5":return"mc";case"4":return"visa"}return"amex"}},getSupportedTypes:function(){return["amex","mc","disc","visa"]},isAllowedChar:function(a){return/[\d -]/.test(a)}});DataString.Date=DataString.createSubclass({parsers:[[/(1[0-2]|0\d|\d)\s*\/\s*(3[01]|[0-2]\d|\d)\s*\/\s*([1-9]\d{3})/,"$2/$3/$1"],[/([1-9]\d{3})\s*-\s*(1[0-2]|0\d|\d)\s*-\s*(3[01]|[0-2]\d|\d)/,"$2/$3/$1"],[/(1[0-2]|0\d|\d)\s*[\/-]\s*(3[01]|[0-2]\d|\d)\s*[\/-]\s*([1-9]\d{3})/,"$1/$2/$3"],[/(3[01]|[0-2]\d|\d)\s*[ -]\s*(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s*[ -]\s*([1-9]\d{3})/i,"$2 $1, $3"],[/(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s+(3[01]|[0-2]\d|\d),?\s*([1-9]\d{3})/i,"$2 $1, $3"],[/(3[01]|[0-2]\d|\d)\s*\.\s*(1[0-2]|0\d|\d)\s*\.\s*([1-9]\d{3})/,"$2/$1/$3"]],setValue:function(a){this.raw=a||"";this.date=undefined;if(this.raw.length){var c,b=0;while((c=this.parsers[b++])){if(!a.match(c[0])){continue}this.date=new Date(Date.parse(a.replace(c[0],c[1])))}}return this},isValid:function(){return !!this.date},format:function(){if(!this.isValid()){return""}var a=this.date.getMonth()+1;return this.date.getFullYear()+"-"+(a<10?"0":"")+a+"-"+this.date.getDate()},valueOf:function(){return this.date||""}});DataString.Number=DataString.createSubclass({isValid:function(){return this.raw.match(/^-?[\d,]+(:?\.[\d]+)?%?$/)},format:function(a){return DataString.numberFormat(this.valueOf(),a)},valueOf:function(){var a=parseFloat(this.raw.replace(/[^\d.-]/g,""));return isNaN(a)?0:a},isAllowedChar:function(a){return/[\d$.-]/.test(a)}});DataString.Dollars=DataString.Number.createSubclass({format:function(a){return"$"+DataString.numberFormat(this.valueOf(),a?0:2)},isValid:function(){return(/^\$?\d+(\.\d\d)?$/).test(this.raw.replace(/,/g,""))}});DataString.Email=DataString.createSubclass({matcher:/^[^@]+@[^@]+$/,isValid:function(){return this.matcher.test(this.raw)}});DataString.Percent=DataString.Number.createSubclass({format:function(a){if(!this.isValid()){return""}var b=this.raw.replace(/[^\d.-]/g,"");if(typeof a!="undefined"){b=b.toFixed(a)}return b+"%"},valueOf:function(){var a=parseFloat(this.raw.replace(/[^\d.-]/g,""));if(isNaN(a)){return 0}return a/100},isAllowedChar:function(a){return(/[\d,.%-]/).test(a)}});DataString.PhoneUs10=DataString.createSubclass({matcher:/^1?\D*([2-9]\d{2})\D*([2-9]\d{2})\D*(\d{4})($|\D.*$)/,isValid:function(){var a=this.raw.match(this.matcher);if(!a||a[2]=="555"){return false}return true},format:function(){return this.raw.replace(this.matcher,"($1) $2-$3$4")},valueOf:function(){return this.raw.replace(this.matcher,"$1$2$3")}});DataString.PhoneUs7=DataString.createSubclass({matcher:/^([2-9]\d{2})\D*(\d{4})($|\D.*$)/,isValid:function(){var a=this.raw.match(this.matcher);if(!a||a[1]=="555"){return false}return true},format:function(){return this.raw.replace(this.matcher,"$1-$2$3")},valueOf:function(){return this.raw.replace(this.matcher,"$1$2")}});DataString.Ssn=DataString.createSubclass({matcher:/^(\d{3})\D*(\d{2})\D*(\d{4})$/,isValid:function(){var a=this.raw.match(this.matcher);if(!a){return false}if(a[1]=="000"||a[2]=="00"||a[3]=="0000"){return false}return true},format:function(){var a;if((a=this.raw.match(this.matcher))){return a[1]+"-"+a[2]+"-"+a[3]}return this.raw},valueOf:function(){var a;if((a=this.raw.match(this.matcher))){return a[1]+a[2]+a[3]}return this.raw}});DataString.UrlAscii=DataString.createSubclass({matchers:{scheme:/^([a-z]+)\:/i,user:/:\/\/([\w._+-]+)(?:\:|@)/,pass:/:([\w._+-]+)@/,host:/(?:@|\:\/\/)([\w.-]+)/,host2:/@([\w.-]+)/,port:/:(\d+)(?:\/|$)/,path:/:\/\/[\w:@._+-]+\/([^?#]+)/,query:/\?([^#]+)(?:#|$)/,fragment:/#(.+)$/},isValid:function(){return !!this.getParts();console.log(combined);return this.raw==combined},getParts:function(){var c={},a;for(var b in this.matchers){if((a=this.raw.match(this.matchers[b]))){c[b]=a[1]}else{c[b]=false}}if((!c.scheme||!c.host)||(c.password&&!c.user)){return false}c.path=c.path?c.path.replace(/\/$/,""):false;if(c.pass==c.port){c.pass=false}if(c.user==c.host){a=this.raw.match(this.matchers.host2);if(!a){return false}c.host=a[1]}return c}});DataString.ZipUs=DataString.createSubclass({matcher:/^(\d{5})(:?-(\d{4}))$/,isValid:function(){return this.matcher.test(this.raw)},valueOf:function(){if(!this.isValid){return""}var a=this.raw.match(this.matcher);return a?a[1]:""}});
