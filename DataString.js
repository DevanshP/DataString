/*
 * DataString JavaScript and PHP Library v0.8
 * (c) 2010 Ken Snyder, MIT-style license
 * http://http://github.com/kensnyder/DataString
 */
(function(a){var f={};function h(l,j){for(var k in j){if(Object.prototype.hasOwnProperty.call(j,k)){l[k]=j[k]}}}function g(j){return typeof j=="string"?document.getElementById(j):j}var c=document.addEventListener?function(j,k,l){j.addEventListener(k,l,false)}:function(j,k,l){j.attachEvent("on"+k,l)};var d={validateInput:function(j,m){j=g(j);var k=new this;function l(){k.raw=j.value;if(!k.isValid()){m.call(k,j)}}c(j,"blur",l);c(j,"change",l)},autoFormatInput:function(k,l){k=g(k);var m=new this;function j(){m.raw=k.value;k.value=m.format.apply(m,l)}c(k,"blur",j);c(k,"change",j)},keyMaskInput:function(k){k=g(k);var l=new this;function j(m){m=m||window.event;if(m.ctrlKey||m.metaKey||m.altKey||!m.keyCode){return}var n=m.keyCode;console.log(n,String.fromCharCode(n));if(n<10||n==27){return}var o=String.fromCharCode(n);if(o&&!l.isAllowedChar(o)){m.preventDefault&&m.preventDefault();m.returnValue=false}}c(k,"keydown",j)}};var i={setValue:function(j){this.raw=(typeof j=="undefined"||j===null?"":j+"").replace(/^\s+/,"").replace(/\s+$/,"");return this},equals:function(j){return this.toString()===(j instanceof e?j:new this.constructor(j)).toString()},copy:function(){return new this(this.toString())},isValid:function(){return true},isEmpty:function(){return this.raw===""},format:function(){return this.raw},toString:function(){return this.format()},valueOf:function(){return this.raw},isAllowedChar:function(j){return true}};var b=function(k){var j=function(l){if(l!==f){this.setValue(l)}};h(j,d);j.createSubclass=b;j.prototype=new this(f);j.prototype.constructor=j;j.prototype.constructor.parent=this;if(k){h(j.prototype,k)}return j};function e(j){if(j!==f){this.setValue(j)}}e.createSubclass=b;h(e,d);h(e.prototype,i);e.numberFormat=function(q,l){q=parseFloat(q+"");q=isNaN(q)?0:q;if(l>=0){q=q.toFixed(l)}else{q=""+q}var p=q.split(".");var o=p[0];var k=p[1];var j=(o.charAt(0)=="-"?"-":"");o=o.replace("-","");var m=[];while(o.length){m.unshift(o.slice(-3));o=o.slice(0,-3)}return j+m.join(e.numberFormat.thousandsSeparator)+(k?e.numberFormat.decimalPoint+k:"")};e.numberFormat.thousandsSeparator=",";e.numberFormat.decimalPoint=".";a.DataString=e})(this);DataString.Aba=DataString.createSubclass({isValid:function(){var a=this.format();if(a.length!=9||a=="000000000"){return false}var b=((a[0]*3)+(a[1]*7)+(a[2]*1)+(a[3]*3)+(a[4]*7)+(a[5]*1)+(a[6]*3)+(a[7]*7)+(a[8]*1));return((b%10)==0)},format:function(){return this.raw.replace(/\D/g,"")},isAllowedChar:function(a){return/\d/.test(a)}});DataString.Cc=DataString.createSubclass({matcher15:/^(\d{4})\D*(\d{6})\D*(\d{5})$/,matcher16:/^(\d{4})\D*(\d{4})\D*(\d{4})\D*(\d{4})$/,isValid:function(){return this.isValidFormat()&&this.isValidChecksum()&&this.isSupportedType()},isSupportedType:function(){var b=this.getType();var a=this.getSupportedTypes().join(" ");return(" "+a+" ").indexOf(" "+b+" ")>-1},isValidFormat:function(){return this.raw.match(this.matcher15)||this.raw.match(this.matcher16)},isValidChecksum:function(){var c=this.valueOf();var a=0,b=0;while(a<c.length){b+=((a%2)==0?2:1)*parseInt(c[a++],10)}return(b%10)==0},format:function(b){var a;if((a=this.raw.match(this.matcher16))){if(b){a[1]="XXXX";a[2]="XXXXXX";a[3]="X".m.slice(1)}a.shift();return a.join("-")}else{if((a=this.raw.match(this.matcher15))){if(b){a[1]=a[2]=a[3]="XXXX"}a.shift();return a.join("-")}}return this.raw},valueOf:function(){return this.raw.replace(/\D/g,"")},getType:function(){var a;if((a=this.raw.match(/^(34|35|36|37|4|5|6011)/))){switch(a[1]){case"6011":return"disc";case"5":return"mc";case"4":return"visa"}return"amex"}},getSupportedTypes:function(){return["amex","mc","disc","visa"]},isAllowedChar:function(a){return/[\d -]/.test(a)}});DataString.Dollars=DataString.Number.createSubclass({format:function(a){return"$"+DataString.numberFormat(this.valueOf(),a?0:2)},valueOf:function(){return parseFloat(this.raw.replace(/[^\d.-]/g,""))}});DataString.PhoneUs10=DataString.createSubclass({matcher:/^1?\D*([2-9]\d{2})\D*([2-9]\d{2})\D*(\d{4})($|\D.*$)/,isValid:function(){var a=this.raw.match(this.matcher);if(!a||a[2]=="555"){return false}return true},format:function(){return this.raw.replace(this.matcher,"($1) $2-$3$4")},valueOf:function(){return this.raw.replace(this.matcher,"$1$2$3$4")}});